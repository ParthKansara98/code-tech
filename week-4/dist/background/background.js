/*! For license information please see background.js.LICENSE.txt */
(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e,r){return(e=c(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function r(){var t,e,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.toStringTag||"@@toStringTag";function c(r,o,i,a){var c=o&&o.prototype instanceof s?o:s,l=Object.create(c.prototype);return n(l,"_invoke",function(r,n,o){var i,a,c,s=0,l=o||[],f=!1,y={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,r){return i=e,a=0,c=t,y.n=r,u}};function p(r,n){for(a=r,c=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],p=y.p,v=i[2];r>3?(o=v===n)&&(a=i[4]||3,c=i[5]===t?i[3]:i[5],i[4]=3,i[5]=t):i[0]<=p&&((o=r<2&&p<i[1])?(a=0,y.v=n,y.n=i[1]):p<v&&(o=r<3||i[0]>n||n>v)&&(i[4]=r,i[5]=n,y.n=v,a=0))}if(o||r>1)return u;throw f=!0,n}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,v),a=l,c=v;(e=a<2?t:c)||!f;){i||(a?a<3?(a>1&&(y.n=-1),p(a,c)):y.n=c:y.v=c);try{if(s=2,i){if(a||(o="next"),e=i[o]){if(!(e=e.call(i,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,a<2&&(a=0)}else 1===a&&(e=i.return)&&e.call(i),a<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=t}else if((e=(f=y.n<0)?c:r.call(n,y))!==u)break}catch(e){i=t,a=1,c=e}finally{s=1}}return{value:e,done:f}}}(r,i,a),!0),l}var u={};function s(){}function l(){}function f(){}e=Object.getPrototypeOf;var y=[][i]?e(e([][i]())):(n(e={},i,(function(){return this})),e),p=f.prototype=s.prototype=Object.create(y);function v(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,n(t,a,"GeneratorFunction")),t.prototype=Object.create(p),t}return l.prototype=f,n(p,"constructor",f),n(f,"constructor",l),l.displayName="GeneratorFunction",n(f,a,"GeneratorFunction"),n(p),n(p,a,"Generator"),n(p,i,(function(){return this})),n(p,"toString",(function(){return"[object Generator]"})),(r=function(){return{w:c,m:v}})()}function n(t,e,r,o){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}n=function(t,e,r,o){if(e)i?i(t,e,{value:r,enumerable:!o,configurable:!o,writable:!o}):t[e]=r;else{var a=function(e,r){n(t,e,(function(t){return this._invoke(e,r,t)}))};a("next",0),a("throw",1),a("return",2)}},n(t,e,r,o)}function o(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function i(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function c(t){o(a,n,i,c,u,"next",t)}function u(t){o(a,n,i,c,u,"throw",t)}c(void 0)}))}}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,c(n.key),n)}}function c(e){var r=function(e){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=t(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(r)?r:r+""}var u=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},n=[{key:"get",value:(y=i(r().m((function t(e){var n,o;return r().w((function(t){for(;;)switch(t.n){case 0:return t.p=0,t.n=1,chrome.storage.sync.get(e);case 1:return n=t.v,t.a(2,n[e]);case 2:return t.p=2,o=t.v,console.error("Storage get error:",o),t.a(2,null)}}),t,null,[[0,2]])}))),function(t){return y.apply(this,arguments)})},{key:"set",value:(f=i(r().m((function t(n,o){var i;return r().w((function(t){for(;;)switch(t.n){case 0:return t.p=0,t.n=1,chrome.storage.sync.set(e({},n,o));case 1:return t.a(2,!0);case 2:return t.p=2,i=t.v,console.error("Storage set error:",i),t.a(2,!1)}}),t,null,[[0,2]])}))),function(t,e){return f.apply(this,arguments)})},{key:"remove",value:(l=i(r().m((function t(e){var n;return r().w((function(t){for(;;)switch(t.n){case 0:return t.p=0,t.n=1,chrome.storage.sync.remove(e);case 1:return t.a(2,!0);case 2:return t.p=2,n=t.v,console.error("Storage remove error:",n),t.a(2,!1)}}),t,null,[[0,2]])}))),function(t){return l.apply(this,arguments)})},{key:"clear",value:(s=i(r().m((function t(){var e;return r().w((function(t){for(;;)switch(t.n){case 0:return t.p=0,t.n=1,chrome.storage.sync.clear();case 1:return t.a(2,!0);case 2:return t.p=2,e=t.v,console.error("Storage clear error:",e),t.a(2,!1)}}),t,null,[[0,2]])}))),function(){return s.apply(this,arguments)})},{key:"getAll",value:(u=i(r().m((function t(){var e,n;return r().w((function(t){for(;;)switch(t.n){case 0:return t.p=0,t.n=1,chrome.storage.sync.get(null);case 1:return e=t.v,t.a(2,e);case 2:return t.p=2,n=t.v,console.error("Storage getAll error:",n),t.a(2,{})}}),t,null,[[0,2]])}))),function(){return u.apply(this,arguments)})},{key:"getLocal",value:(c=i(r().m((function t(e){var n,o;return r().w((function(t){for(;;)switch(t.n){case 0:return t.p=0,t.n=1,chrome.storage.local.get(e);case 1:return n=t.v,t.a(2,n[e]);case 2:return t.p=2,o=t.v,console.error("Local storage get error:",o),t.a(2,null)}}),t,null,[[0,2]])}))),function(t){return c.apply(this,arguments)})},{key:"setLocal",value:(o=i(r().m((function t(n,o){var i;return r().w((function(t){for(;;)switch(t.n){case 0:return t.p=0,t.n=1,chrome.storage.local.set(e({},n,o));case 1:return t.a(2,!0);case 2:return t.p=2,i=t.v,console.error("Local storage set error:",i),t.a(2,!1)}}),t,null,[[0,2]])}))),function(t,e){return o.apply(this,arguments)})}],n&&a(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,o,c,u,s,l,f,y}();function s(t){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s(t)}function l(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof c?n:c,s=Object.create(u.prototype);return f(s,"_invoke",function(r,n,o){var i,c,u,s=0,l=o||[],f=!1,y={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,r){return i=e,c=0,u=t,y.n=r,a}};function p(r,n){for(c=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],p=y.p,v=i[2];r>3?(o=v===n)&&(c=i[4]||3,u=i[5]===t?i[3]:i[5],i[4]=3,i[5]=t):i[0]<=p&&((o=r<2&&p<i[1])?(c=0,y.v=n,y.n=i[1]):p<v&&(o=r<3||i[0]>n||n>v)&&(i[4]=r,i[5]=n,y.n=v,c=0))}if(o||r>1)return a;throw f=!0,n}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,v),c=l,u=v;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(y.n=-1),p(c,u)):y.n=u:y.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=y.n<0)?u:r.call(n,y))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var y=[][n]?e(e([][n]())):(f(e={},n,(function(){return this})),e),p=s.prototype=c.prototype=Object.create(y);function v(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,f(t,o,"GeneratorFunction")),t.prototype=Object.create(p),t}return u.prototype=s,f(p,"constructor",s),f(s,"constructor",u),u.displayName="GeneratorFunction",f(s,o,"GeneratorFunction"),f(p),f(p,o,"Generator"),f(p,n,(function(){return this})),f(p,"toString",(function(){return"[object Generator]"})),(l=function(){return{w:i,m:v}})()}function f(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}f=function(t,e,r,n){if(e)o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r;else{var i=function(e,r){f(t,e,(function(t){return this._invoke(e,r,t)}))};i("next",0),i("throw",1),i("return",2)}},f(t,e,r,n)}function y(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function p(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){y(i,n,o,a,c,"next",t)}function c(t){y(i,n,o,a,c,"throw",t)}a(void 0)}))}}function v(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,h(n.key),n)}}function h(t){var e=function(t){if("object"!=s(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=s(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==s(e)?e:e+""}var m=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},e=[{key:"show",value:(n=p(l().m((function t(e,r){var n,o,i,a,c,u=arguments;return l().w((function(t){for(;;)switch(t.n){case 0:return n=u.length>2&&void 0!==u[2]?u[2]:"info",o=u.length>3&&void 0!==u[3]?u[3]:[],t.p=1,i="productivity_".concat(Date.now()),a={type:"basic",iconUrl:"../icons/icon48.png",title:e,message:r,buttons:o.length>0?o:void 0,requireInteraction:"warning"===n},t.n=2,chrome.notifications.create(i,a);case 2:return"info"===n&&setTimeout((function(){chrome.notifications.clear(i)}),5e3),t.a(2,i);case 3:return t.p=3,c=t.v,console.error("Notification error:",c),t.a(2,null)}}),t,null,[[1,3]])}))),function(t,e){return n.apply(this,arguments)})},{key:"clear",value:(r=p(l().m((function t(e){var r;return l().w((function(t){for(;;)switch(t.n){case 0:return t.p=0,t.n=1,chrome.notifications.clear(e);case 1:return t.a(2,!0);case 2:return t.p=2,r=t.v,console.error("Clear notification error:",r),t.a(2,!1)}}),t,null,[[0,2]])}))),function(t){return r.apply(this,arguments)})},{key:"setupClickHandler",value:function(t){chrome.notifications&&chrome.notifications.onClicked&&chrome.notifications.onClicked.addListener(t)}},{key:"setupButtonClickHandler",value:function(t){chrome.notifications&&chrome.notifications.onButtonClicked&&chrome.notifications.onButtonClicked.addListener(t)}}],e&&v(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n}();function b(t){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},b(t)}function d(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,s=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){s=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(s)throw o}}return c}}(t,e)||function(t,e){if(t){if("string"==typeof t)return g(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?g(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function w(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function k(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?w(Object(r),!0).forEach((function(e){T(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function T(t,e,r){return(e=E(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function D(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof c?n:c,s=Object.create(u.prototype);return S(s,"_invoke",function(r,n,o){var i,c,u,s=0,l=o||[],f=!1,y={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,r){return i=e,c=0,u=t,y.n=r,a}};function p(r,n){for(c=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],p=y.p,v=i[2];r>3?(o=v===n)&&(c=i[4]||3,u=i[5]===t?i[3]:i[5],i[4]=3,i[5]=t):i[0]<=p&&((o=r<2&&p<i[1])?(c=0,y.v=n,y.n=i[1]):p<v&&(o=r<3||i[0]>n||n>v)&&(i[4]=r,i[5]=n,y.n=v,c=0))}if(o||r>1)return a;throw f=!0,n}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,v),c=l,u=v;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(y.n=-1),p(c,u)):y.n=u:y.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=y.n<0)?u:r.call(n,y))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][n]?e(e([][n]())):(S(e={},n,(function(){return this})),e),f=s.prototype=c.prototype=Object.create(l);function y(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,S(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,S(f,"constructor",s),S(s,"constructor",u),u.displayName="GeneratorFunction",S(s,o,"GeneratorFunction"),S(f),S(f,o,"Generator"),S(f,n,(function(){return this})),S(f,"toString",(function(){return"[object Generator]"})),(D=function(){return{w:i,m:y}})()}function S(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}S=function(t,e,r,n){if(e)o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r;else{var i=function(e,r){S(t,e,(function(t){return this._invoke(e,r,t)}))};i("next",0),i("throw",1),i("return",2)}},S(t,e,r,n)}function O(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function j(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){O(i,n,o,a,c,"next",t)}function c(t){O(i,n,o,a,c,"throw",t)}a(void 0)}))}}function P(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,E(n.key),n)}}function E(t){var e=function(t){if("object"!=b(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=b(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==b(e)?e:e+""}new(function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.activeTab=null,this.sessionStart=null,this.dailyData={},this.settings={},this.init()},e=[{key:"init",value:(l=j(D().m((function t(){var e;return D().w((function(t){for(;;)switch(t.n){case 0:return t.p=0,t.n=1,this.loadSettings();case 1:return t.n=2,this.loadDailyData();case 2:this.setupTabListeners(),this.setupNavigationListeners(),this.setupAlarmListeners(),this.setupDailyReset(),console.log("Productivity Tracker initialized successfully"),t.n=4;break;case 3:t.p=3,e=t.v,console.error("Error initializing Productivity Tracker:",e);case 4:return t.a(2)}}),t,this,[[0,3]])}))),function(){return l.apply(this,arguments)})},{key:"loadSettings",value:(s=j(D().m((function t(){var e;return D().w((function(t){for(;;)switch(t.n){case 0:return t.n=1,u.get("settings");case 1:if(e=t.v){t.n=2;break}e={productiveWebsites:["github.com","stackoverflow.com","docs.google.com"],distractingWebsites:["youtube.com","facebook.com","twitter.com","instagram.com"],dailyGoals:{productiveTime:480,maxDistractingTime:60},notifications:{enabled:!0,distractingTimeLimit:30},theme:"light"};case 2:this.settings=e;case 3:return t.a(2)}}),t,this)}))),function(){return s.apply(this,arguments)})},{key:"loadDailyData",value:(c=j(D().m((function t(){var e,r;return D().w((function(t){for(;;)switch(t.n){case 0:return e=(new Date).toDateString(),t.n=1,u.get("dailyData_".concat(e));case 1:if(r=t.v){t.n=2;break}r={date:e,websites:{},totalProductiveTime:0,totalDistractingTime:0,goals:k({},this.settings.dailyGoals)};case 2:this.dailyData=r;case 3:return t.a(2)}}),t,this)}))),function(){return c.apply(this,arguments)})},{key:"setupTabListeners",value:function(){var t=this;chrome.tabs?(chrome.tabs.onActivated.addListener(function(){var e=j(D().m((function e(r){return D().w((function(e){for(;;)switch(e.n){case 0:return e.n=1,t.handleTabChange(r.tabId);case 1:return e.a(2)}}),e)})));return function(t){return e.apply(this,arguments)}}()),chrome.tabs.onUpdated.addListener(function(){var e=j(D().m((function e(r,n,o){return D().w((function(e){for(;;)switch(e.n){case 0:if("complete"!==n.status||!o.active){e.n=1;break}return e.n=1,t.handleTabChange(r);case 1:return e.a(2)}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()),chrome.windows&&chrome.windows.onFocusChanged.addListener(function(){var e=j(D().m((function e(r){var n,o,i,a;return D().w((function(e){for(;;)switch(e.n){case 0:if(r!==chrome.windows.WINDOW_ID_NONE){e.n=1;break}t.stopTracking(),e.n=5;break;case 1:return e.p=1,e.n=2,chrome.tabs.query({active:!0,windowId:r});case 2:if(n=e.v,o=d(n,1),!(i=o[0])){e.n=3;break}return e.n=3,t.handleTabChange(i.id);case 3:e.n=5;break;case 4:e.p=4,a=e.v,console.error("Error querying active tab:",a);case 5:return e.a(2)}}),e,null,[[1,4]])})));return function(t){return e.apply(this,arguments)}}())):console.error("Chrome tabs API not available")}},{key:"setupNavigationListeners",value:function(){var t=this;chrome.webNavigation?chrome.webNavigation.onCommitted.addListener(function(){var e=j(D().m((function e(r){var n;return D().w((function(e){for(;;)switch(e.n){case 0:if(0!==r.frameId){e.n=5;break}return e.p=1,e.n=2,chrome.tabs.get(r.tabId);case 2:if(!e.v.active){e.n=3;break}return e.n=3,t.handleTabChange(r.tabId);case 3:e.n=5;break;case 4:e.p=4,n=e.v,console.error("Error handling navigation:",n);case 5:return e.a(2)}}),e,null,[[1,4]])})));return function(t){return e.apply(this,arguments)}}()):console.warn("Chrome webNavigation API not available")}},{key:"setupAlarmListeners",value:function(){var t=this;chrome.alarms&&chrome.alarms.onAlarm?chrome.alarms.onAlarm.addListener((function(e){"dailyReset"===e.name?t.resetDailyData():"checkDistractingTime"===e.name&&t.checkDistractingTimeLimit()})):console.warn("Chrome alarms API not available")}},{key:"setupDailyReset",value:function(){if(chrome.alarms&&chrome.alarms.create){var t=new Date,e=new Date(t);e.setDate(e.getDate()+1),e.setHours(0,0,0,0),chrome.alarms.create("dailyReset",{when:e.getTime(),periodInMinutes:1440}),chrome.alarms.create("checkDistractingTime",{periodInMinutes:5})}else console.warn("Chrome alarms API not available - using fallback timing")}},{key:"handleTabChange",value:(a=j(D().m((function t(e){var r,n;return D().w((function(t){for(;;)switch(t.n){case 0:return t.p=0,this.stopTracking(),t.n=1,chrome.tabs.get(e);case 1:if((r=t.v).url&&!r.url.startsWith("chrome://")){t.n=2;break}return t.a(2);case 2:this.activeTab={id:e,url:r.url,domain:this.extractDomain(r.url)},this.sessionStart=Date.now(),console.log("Started tracking: ".concat(this.activeTab.domain)),t.n=4;break;case 3:t.p=3,n=t.v,console.error("Error handling tab change:",n);case 4:return t.a(2)}}),t,this,[[0,3]])}))),function(t){return a.apply(this,arguments)})},{key:"stopTracking",value:function(){if(this.activeTab&&this.sessionStart){var t=Math.round((Date.now()-this.sessionStart)/1e3/60);t>0&&this.updateTimeSpent(this.activeTab.domain,t)}this.activeTab=null,this.sessionStart=null}},{key:"updateTimeSpent",value:(i=j(D().m((function t(e,r){var n;return D().w((function(t){for(;;)switch(t.n){case 0:return this.dailyData.websites[e]||(this.dailyData.websites[e]={time:0,visits:0,category:this.categorizeWebsite(e)}),this.dailyData.websites[e].time+=r,this.dailyData.websites[e].visits+=1,"productive"===(n=this.dailyData.websites[e].category)?this.dailyData.totalProductiveTime+=r:"distracting"===n&&(this.dailyData.totalDistractingTime+=r),t.n=1,this.saveDailyData();case 1:console.log("Updated ".concat(e,": +").concat(r," minutes (").concat(n,")"));case 2:return t.a(2)}}),t,this)}))),function(t,e){return i.apply(this,arguments)})},{key:"categorizeWebsite",value:function(t){return this.settings.productiveWebsites.some((function(e){return t.includes(e)}))?"productive":this.settings.distractingWebsites.some((function(e){return t.includes(e)}))?"distracting":"neutral"}},{key:"extractDomain",value:function(t){try{return new URL(t).hostname}catch(e){return t}}},{key:"checkDistractingTimeLimit",value:(o=j(D().m((function t(){var e;return D().w((function(t){for(;;)switch(t.n){case 0:if(this.settings.notifications.enabled){t.n=1;break}return t.a(2);case 1:e=this.settings.notifications.distractingTimeLimit,this.dailyData.totalDistractingTime>=e&&m.show("Productivity Alert","You've spent ".concat(this.dailyData.totalDistractingTime," minutes on distracting websites today. Time to refocus!"),"warning");case 2:return t.a(2)}}),t,this)}))),function(){return o.apply(this,arguments)})},{key:"saveDailyData",value:(n=j(D().m((function t(){var e;return D().w((function(t){for(;;)switch(t.n){case 0:return e=(new Date).toDateString(),t.n=1,u.set("dailyData_".concat(e),this.dailyData);case 1:return t.a(2)}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"resetDailyData",value:(r=j(D().m((function t(){var e;return D().w((function(t){for(;;)switch(t.n){case 0:return e=(new Date).toDateString(),this.dailyData={date:e,websites:{},totalProductiveTime:0,totalDistractingTime:0,goals:k({},this.settings.dailyGoals)},t.n=1,this.saveDailyData();case 1:return t.a(2)}}),t,this)}))),function(){return r.apply(this,arguments)})}],e&&P(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n,o,i,a,c,s,l}())})();